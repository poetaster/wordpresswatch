#!/usr/bin/bash
# This script watches inotifywait generated /var/log/wpwatch.log for changes wordpress files
DATE=`/bin/date`
HOSTNAME=`hostname`
if [[ `wc -w /var/log/wpwatch.log | cut -f 1 -d ' '` > 0 ]] ; then 
  /usr/bin/cat /var/log/wpwatch.log | /usr/bin/mailx admin@netzpolitik.org -a 'FROM:mwa@netzpolitik.org' -a "SUBJECT:!WPALARM!$HOSTNAME"
  # reset log file
  /usr/bin/mv /var/log/wpwatch.log "/var/log/wpwatch.log$DATE"
  touch  /var/log/wpwatch.log
  /usr/sbin/service wpwatch restart
fi
exit 0
